<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>German W-Fragen Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(to right top, #6d28d9, #8b5cf6, #a78bfa, #c4b5fd, #ddd6fe);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
            color: #374151; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent; 
        }
        .card {
            background-color: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            text-align: center;
            width: 100%;
            max-width: 700px;
        }
        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, border-color 0.3s ease, opacity 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            margin-top: 8px;
        }
        .btn:disabled {
            background-color: #d1d5db !important; 
            color: #6b7280 !important;
            border-color: #d1d5db !important;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.7;
        }
        .btn:active:not(:disabled) { transform: translateY(1px); }
        .btn-primary { background-color: #6d28d9; } 
        .btn-primary:hover:not(:disabled) { background-color: #5b21b6; }
        .btn-secondary { background-color: #4f46e5; } 
        .btn-secondary:hover:not(:disabled) { background-color: #4338ca; }
        .btn-success { background-color: #059669; }
        .btn-success:hover:not(:disabled) { background-color: #047857; }

        .w-frage-option-btn {
            padding: 12px 8px;
            font-size: 1.1rem;
            line-height: 1.3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
        }
        .w-frage-option-btn .translation {
            font-size: 0.7rem;
            font-weight: 400;
            opacity: 0.9;
            margin-top: 2px;
        }

        .speed-round-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .speed-round-word {
            font-size: 4rem;
            font-weight: 800;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .speed-round-meaning {
            font-size: 1.5rem;
            margin: 10px 0;
            opacity: 0.9;
        }

        .timer-bar {
            width: 100%;
            height: 8px;
            background-color: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .timer-fill {
            height: 100%;
            background-color: #10b981;
            transition: width 0.1s linear;
            border-radius: 4px;
        }

        .feedback-area {
            font-size: 1.125rem; 
            font-weight: 600; 
            padding: 12px;
            border-radius: 8px; 
            min-height: 50px;
            margin-bottom: 1.5rem;
        }
        .feedback-area.correct { 
            color: #059669; background-color: #ecfdf5; border: 1px solid #a7f3d0; display: block !important;
        }
        .feedback-area.incorrect { 
            color: #dc2626; background-color: #fee2e2; border: 1px solid #fecaca; display: block !important;
        }
        .feedback-area .correct-answer-text {
            font-weight: 700;
        }

        .progress-text { margin-top: 12px; font-size: 0.875rem; color: #6b7280; }
        .hint {
            font-size: 0.9em;
            color: #4b5563; 
            font-style: italic;
            margin-left: 8px;
            display: block; 
            margin-top: 4px;
        }
        .hidden { display: none !important; }
        
        #sentence-display {
            line-height: 1.5; 
        }

        #w-frage-choices-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px; 
        }
        #w-frage-choices-container .btn {
            flex-basis: calc(33.333% - 12px); 
            min-width: 120px; 
        }

        .mode-selection {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 16px 24px;
            font-size: 1.1rem;
            border-radius: 12px;
            min-width: 200px;
        }

        @media (max-width: 768px) { 
            #w-frage-choices-container .btn {
                flex-basis: calc(50% - 10px); 
            }
            .mode-selection {
                flex-direction: column;
                align-items: center;
            }
            .speed-round-word {
                font-size: 3rem;
            }
        }

        @media (max-width: 640px) { 
            .card { padding: 20px; }
            .btn { padding: 10px 16px; font-size: 0.9rem; }
            .w-frage-option-btn { font-size: 1rem; min-height: 65px; }
            .w-frage-option-btn .translation { font-size: 0.65rem; }
            #sentence-display { font-size: 1.125rem; } 
            .feedback-area { font-size: 1rem; }
             #w-frage-choices-container .btn {
                flex-basis: calc(50% - 8px); 
                 min-width: 100px;
            }
            .speed-round-word {
                font-size: 2.5rem;
            }
            .speed-round-meaning {
                font-size: 1.2rem;
            }
        }
        @media (max-width: 420px) {
             #w-frage-choices-container .btn {
                flex-basis: calc(100% - 8px); 
            }
        }
    </style>
</head>
<body>
    <div id="main-container" class="card">
        <!-- Mode Selection -->
        <div id="mode-selection-screen" class="">
            <h1 class="text-2xl sm:text-3xl font-bold text-violet-700 mb-6 text-center">German W-Fragen</h1>
            <div class="mode-selection">
                <button id="quiz-mode-btn" class="btn btn-primary mode-btn">
                    üìù Quiz Mode
                    <div class="text-sm opacity-90 mt-1">Test your knowledge</div>
                </button>
                <button id="speed-mode-btn" class="btn btn-success mode-btn">
                    ‚ö° Speed Learning
                    <div class="text-sm opacity-90 mt-1">Quick multiple choice</div>
                </button>
            </div>
        </div>

        <!-- Quiz Mode -->
        <div id="quiz-mode-screen" class="hidden">
            <h1 class="text-2xl sm:text-3xl font-bold text-violet-700 mb-6 text-center">German W-Fragen Quiz</h1>

            <div id="question-area" class="mb-6">
                <p id="sentence-display" class="text-xl sm:text-2xl font-semibold text-gray-800 mb-2 text-center" style="min-height: 70px;"></p>
                <p id="translation-en" class="text-sm text-gray-500 italic text-center"></p>
                <p id="translation-es" class="text-sm text-gray-500 italic text-center mb-4"></p>
            </div>

            <div id="w-frage-choices-container" class="mb-6">
            </div>

            <div id="feedback-area" class="feedback-area hidden"></div>

            <div id="quiz-controls-area" class="text-center">
                <button id="next-question-btn" class="btn btn-primary hidden">Next Question</button>
                <button id="restart-quiz-btn" class="btn btn-secondary hidden">Restart Quiz</button>
                <button id="back-to-menu-btn" class="btn btn-secondary">Back to Menu</button>
            </div>

            <div id="progress-indicator" class="progress-text mt-4 text-center">Question 0 / 0</div>
            <div id="score-indicator" class="progress-text mt-1 text-center">Score: 0 / 0</div>
        </div>

        <!-- Speed Learning Mode -->
        <div id="speed-mode-screen" class="hidden">
            <div id="speed-round-container" class="speed-round-card">
                <div id="speed-question-text" class="text-xl mb-4 opacity-90">What does this mean in German?</div>
                <div id="speed-word-en" class="speed-round-word text-yellow-200">Who</div>
                <div id="speed-word-es" class="speed-round-meaning text-yellow-100">Qui√©n</div>
                
                <div class="timer-bar">
                    <div id="timer-fill" class="timer-fill" style="width: 100%;"></div>
                </div>
                
                <div id="speed-choices" class="grid grid-cols-2 gap-4 mt-6 mb-4">
                    <!-- Speed choices will be inserted here -->
                </div>
                
                <div id="speed-feedback" class="text-lg font-bold mb-4 hidden"></div>
                
                <div id="speed-progress" class="text-lg opacity-90">1 / 50</div>
                
                <div id="speed-controls" class="mt-6">
                    <button id="speed-pause-btn" class="btn btn-secondary mr-4">‚è∏Ô∏è Pause</button>
                </div>
            </div>
            
            <div id="speed-complete" class="hidden text-center">
                <h2 class="text-2xl font-bold text-green-600 mb-4">üéâ Speed Round Complete!</h2>
                <p class="text-lg mb-2">You completed 50 questions!</p>
                <p class="text-xl font-bold text-purple-600 mb-6">Final Score: <span id="speed-final-score">0</span> / 50</p>
                <button id="speed-restart-btn" class="btn btn-success mr-4">üîÑ Restart Speed Round</button>
                <button id="speed-back-to-menu-btn" class="btn btn-secondary">Back to Menu</button>
            </div>
        </div>
    </div>

    <script>
        const wFragenDetails = [
            { word: "WER", en: "Who", es: "Qui√©n", color: "bg-sky-500 hover:bg-sky-600" },
            { word: "WIE", en: "How, What", es: "C√≥mo, Qu√©", color: "bg-amber-500 hover:bg-amber-600" },
            { word: "WAS", en: "What", es: "Qu√©", color: "bg-emerald-500 hover:bg-emerald-600" },
            { word: "WO", en: "Where", es: "D√≥nde", color: "bg-rose-500 hover:bg-rose-600" },
            { word: "WOHER", en: "Where from", es: "De d√≥nde", color: "bg-indigo-500 hover:bg-indigo-600" },
            { word: "WELCHE/R/S", en: "Which", es: "Cu√°l, Qu√©", color: "bg-pink-500 hover:bg-pink-600" }
        ];

        const quizQuestions = [
            // WER
            {
                id: 1,
                sentence_german: "____ hat das gesagt? <span class='hint'>(Peter hat das gesagt.)</span>",
                correct_w_frage: "WER",
                translation_en: "Who said that? <span class='hint'>(Peter said that.)</span>",
                translation_es: "¬øQui√©n dijo eso? <span class='hint'>(Peter dijo eso.)</span>"
            },
            {
                id: 12,
                sentence_german: "Mit ____ sprichst du gerade? <span class='hint'>(Mit meiner Freundin Anna.)</span>",
                correct_w_frage: "WER",
                translation_en: "Who are you talking to right now? <span class='hint'>(With my friend Anna.)</span>",
                translation_es: "¬øCon qui√©n est√°s hablando ahora mismo? <span class='hint'>(Con mi amiga Anna.)</span>"
            },
            {
                id: 16,
                sentence_german: "____ spielt die Hauptrolle in diesem Film? <span class='hint'>(Ein ber√ºhmter Schauspieler.)</span>",
                correct_w_frage: "WER",
                translation_en: "Who plays the main role in this film? <span class='hint'>(A famous actor.)</span>",
                translation_es: "¬øQui√©n interpreta el papel principal en esta pel√≠cula? <span class='hint'>(Un actor famoso.)</span>"
            },
            {
                id: 17,
                sentence_german: "Von ____ ist dieses sch√∂ne Geschenk? <span class='hint'>(Von meiner Oma.)</span>",
                correct_w_frage: "WER",
                translation_en: "Who is this beautiful gift from? <span class='hint'>(From my grandma.)</span>",
                translation_es: "¬øDe qui√©n es este hermoso regalo? <span class='hint'>(De mi abuela.)</span>"
            },
            // WIE
            {
                id: 2,
                sentence_german: "____ geht es Ihnen heute? <span class='hint'>(Mir geht es gut, danke.)</span>",
                correct_w_frage: "WIE",
                translation_en: "How are you today? <span class='hint'>(I am fine, thank you.)</span>",
                translation_es: "¬øC√≥mo est√° usted hoy? <span class='hint'>(Estoy bien, gracias.)</span>"
            },
            {
                id: 3,
                sentence_german: "____ ist deine Telefonnummer? <span class='hint'>(Meine Nummer ist 012345.)</span>",
                correct_w_frage: "WIE",
                translation_en: "What is your phone number? <span class='hint'>(My number is 012345.)</span>",
                translation_es: "¬øCu√°l es tu n√∫mero de tel√©fono? <span class='hint'>(Mi n√∫mero es 012345.)</span>"
            },
            {
                id: 9,
                sentence_german: "____ alt sind Sie? <span class='hint'>(Ich bin 30 Jahre alt.)</span>",
                correct_w_frage: "WIE",
                translation_en: "How old are you? <span class='hint'>(I am 30 years old.)</span>",
                translation_es: "¬øCu√°ntos a√±os tiene usted? <span class='hint'>(Tengo 30 a√±os.)</span>"
            },
            {
                id: 11,
                sentence_german: "____ viele √Ñpfel m√∂chtest du? <span class='hint'>(Drei √Ñpfel, bitte.)</span>",
                correct_w_frage: "WIE",
                translation_en: "How many apples would you like? <span class='hint'>(Three apples, please.)</span>",
                translation_es: "¬øCu√°ntas manzanas quieres? <span class='hint'>(Tres manzanas, por favor.)</span>"
            },
            {
                id: 18,
                sentence_german: "____ war dein Wochenende? <span class='hint'>(Es war sehr entspannend.)</span>",
                correct_w_frage: "WIE",
                translation_en: "How was your weekend? <span class='hint'>(It was very relaxing.)</span>",
                translation_es: "¬øC√≥mo estuvo tu fin de semana? <span class='hint'>(Estuvo muy relajante.)</span>"
            },
            // WAS
            {
                id: 4,
                sentence_german: "____ machen Sie beruflich? <span class='hint'>(Ich bin √Ñrztin.)</span>",
                correct_w_frage: "WAS",
                translation_en: "What do you do for a living? <span class='hint'>(I am a doctor.)</span>",
                translation_es: "¬øA qu√© se dedica usted? <span class='hint'>(Soy m√©dica.)</span>"
            },
            {
                id: 10,
                sentence_german: "____ kostet das? <span class='hint'>(Es kostet 10 Euro.)</span>",
                correct_w_frage: "WAS",
                translation_en: "How much does that cost? <span class='hint'>(It costs 10 Euros.)</span>",
                translation_es: "¬øCu√°nto cuesta eso? <span class='hint'>(Cuesta 10 euros.)</span>"
            },
            {
                id: 13,
                sentence_german: "____ hei√üt die Hauptstadt von Frankreich? <span class='hint'>(Paris.)</span>",
                correct_w_frage: "WIE", 
                translation_en: "What is the capital of France called? <span class='hint'>(Paris.)</span>",
                translation_es: "¬øC√≥mo se llama la capital de Francia? <span class='hint'>(Par√≠s.)</span>"
            },
            {
                id: 14,
                sentence_german: "____ m√∂chtest du trinken? <span class='hint'>(Wasser, bitte.)</span>",
                correct_w_frage: "WAS",
                translation_en: "What would you like to drink? <span class='hint'>(Water, please.)</span>",
                translation_es: "¬øQu√© te gustar√≠a beber? <span class='hint'>(Agua, por favor.)</span>"
            },
            {
                id: 19,
                sentence_german: "____ f√ºr Musik h√∂rst du gerne? <span class='hint'>(Ich h√∂re gerne Popmusik.)</span>",
                correct_w_frage: "WAS",
                translation_en: "What kind of music do you like to listen to? <span class='hint'>(I like to listen to pop music.)</span>",
                translation_es: "¬øQu√© tipo de m√∫sica te gusta escuchar? <span class='hint'>(Me gusta escuchar m√∫sica pop.)</span>"
            },
            // WO
            {
                id: 5,
                sentence_german: "____ liegt mein Schl√ºssel? <span class='hint'>(Auf dem Tisch.)</span>",
                correct_w_frage: "WO",
                translation_en: "Where is my key? <span class='hint'>(On the table.)</span>",
                translation_es: "¬øD√≥nde est√° mi llave? <span class='hint'>(Sobre la mesa.)</span>"
            },
            {
                id: 15,
                sentence_german: "____ hast du das gelernt? <span class='hint'>(In der Schule.)</span>",
                correct_w_frage: "WO",
                translation_en: "Where did you learn that? <span class='hint'>(At school.)</span>",
                translation_es: "¬øD√≥nde aprendiste eso? <span class='hint'>(En la escuela.)</span>"
            },
            {
                id: 20,
                sentence_german: "____ befindet sich der n√§chste Supermarkt? <span class='hint'>(Gleich um die Ecke.)</span>",
                correct_w_frage: "WO",
                translation_en: "Where is the nearest supermarket? <span class='hint'>(Just around the corner.)</span>",
                translation_es: "¬øD√≥nde est√° el supermercado m√°s cercano? <span class='hint'>(Justo a la vuelta de la esquina.)</span>"
            },
            {
                id: 21,
                sentence_german: "____ arbeitet deine Schwester? <span class='hint'>(Sie arbeitet in einem Krankenhaus.)</span>",
                correct_w_frage: "WO",
                translation_en: "Where does your sister work? <span class='hint'>(She works in a hospital.)</span>",
                translation_es: "¬øD√≥nde trabaja tu hermana? <span class='hint'>(Trabaja en un hospital.)</span>"
            },
            // WOHER
            {
                id: 6,
                sentence_german: "____ kommt er? <span class='hint'>(Er kommt aus Spanien.)</span>",
                correct_w_frage: "WOHER",
                translation_en: "Where does he come from? <span class='hint'>(He comes from Spain.)</span>",
                translation_es: "¬øDe d√≥nde viene √©l? <span class='hint'>(√âl viene de Espa√±a.)</span>"
            },
            {
                id: 22,
                sentence_german: "____ stammen diese tollen Schuhe? <span class='hint'>(Aus einem kleinen Laden in Italien.)</span>",
                correct_w_frage: "WOHER",
                translation_en: "Where do these great shoes come from? <span class='hint'>(From a small shop in Italy.)</span>",
                translation_es: "¬øDe d√≥nde provienen estos zapatos geniales? <span class='hint'>(De una peque√±a tienda en Italia.)</span>"
            },
            {
                id: 23,
                sentence_german: "____ wei√üt du das alles? <span class='hint'>(Ich habe es in einem Buch gelesen.)</span>",
                correct_w_frage: "WOHER",
                translation_en: "How do you know all that? (lit. Where from do you know all that?) <span class='hint'>(I read it in a book.)</span>",
                translation_es: "¬øDe d√≥nde sabes todo eso? <span class='hint'>(Lo le√≠ en un libro.)</span>"
            },
             {
                id: 24,
                sentence_german: "____ kommt der starke Wind? <span class='hint'>(Er kommt vom Meer.)</span>",
                correct_w_frage: "WOHER",
                translation_en: "Where is the strong wind coming from? <span class='hint'>(It's coming from the sea.)</span>",
                translation_es: "¬øDe d√≥nde viene el viento fuerte? <span class='hint'>(Viene del mar.)</span>"
            },
            // WELCHE/R/S
            {
                id: 7,
                sentence_german: "____ Rock gef√§llt dir besser, der blaue oder der rote? <span class='hint'>(Der blaue Rock.)</span>",
                correct_w_frage: "WELCHE/R/S",
                translation_en: "Which skirt do you like better, the blue one or the red one? <span class='hint'>(The blue skirt.)</span>",
                translation_es: "¬øQu√© falda te gusta m√°s, la azul o la roja? <span class='hint'>(La falda azul.)</span>"
            },
            {
                id: 25,
                sentence_german: "____ Buch m√∂chtest du ausleihen? <span class='hint'>(Das mit dem roten Umschlag.)</span>",
                correct_w_frage: "WELCHE/R/S",
                translation_en: "Which book would you like to borrow? <span class='hint'>(The one with the red cover.)</span>",
                translation_es: "¬øQu√© libro te gustar√≠a tomar prestado? <span class='hint'>(El de la portada roja.)</span>"
            },
            {
                id: 26,
                sentence_german: "Auf ____ Stuhl hast du gesessen? <span class='hint'>(Auf dem Holzstuhl.)</span>",
                correct_w_frage: "WELCHE/R/S",
                translation_en: "Which chair were you sitting on? <span class='hint'>(On the wooden chair.)</span>",
                translation_es: "¬øEn qu√© silla estabas sentado? <span class='hint'>(En la silla de madera.)</span>"
            },
            {
                id: 27,
                sentence_german: "Mit ____ Auto seid ihr gekommen? <span class='hint'>(Mit dem gro√üen Silbernen.)</span>",
                correct_w_frage: "WELCHE/R/S",
                translation_en: "Which car did you come with? <span class='hint'>(With the big silver one.)</span>",
                translation_es: "¬øCon qu√© coche vinieron? <span class='hint'>(Con el grande plateado.)</span>"
            }
        ];

        // Quiz Mode Variables
        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];
        let answerSelected = false;

        // Speed Mode Variables
        let speedCurrentIndex = 0;
        let speedInterval;
        let speedPaused = false;
        let speedTimePerCard = 6000; // 6 seconds per card
        let speedQuestions = [];
        let speedScore = 0;
        let speedAnswered = false;

        // Elements
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const quizModeScreen = document.getElementById('quiz-mode-screen');
        const speedModeScreen = document.getElementById('speed-mode-screen');
        
        const quizModeBtn = document.getElementById('quiz-mode-btn');
        const speedModeBtn = document.getElementById('speed-mode-btn');
        
        // Quiz elements
        const sentenceDisplayEl = document.getElementById('sentence-display');
        const translationEnEl = document.getElementById('translation-en');
        const translationEsEl = document.getElementById('translation-es');
        const choicesContainerEl = document.getElementById('w-frage-choices-container');
        const feedbackAreaEl = document.getElementById('feedback-area');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const progressIndicatorEl = document.getElementById('progress-indicator');
        const scoreIndicatorEl = document.getElementById('score-indicator');

        // Speed elements
        const speedWordEnEl = document.getElementById('speed-word-en');
        const speedWordEsEl = document.getElementById('speed-word-es');
        const speedChoicesEl = document.getElementById('speed-choices');
        const speedFeedbackEl = document.getElementById('speed-feedback');
        const timerFillEl = document.getElementById('timer-fill');
        const speedProgressEl = document.getElementById('speed-progress');
        const speedPauseBtn = document.getElementById('speed-pause-btn');
        const speedCompleteEl = document.getElementById('speed-complete');
        const speedRestartBtn = document.getElementById('speed-restart-btn');
        const speedBackToMenuBtn = document.getElementById('speed-back-to-menu-btn');
        const speedFinalScoreEl = document.getElementById('speed-final-score');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function triggerConfetti() {
            if (typeof confetti === 'function') {
                confetti({ particleCount: 80, spread: 60, origin: { y: 0.6 } });
            }
        }

        // Mode Selection Functions
        function showModeSelection() {
            modeSelectionScreen.classList.remove('hidden');
            quizModeScreen.classList.add('hidden');
            speedModeScreen.classList.add('hidden');
        }

        function showQuizMode() {
            modeSelectionScreen.classList.add('hidden');
            quizModeScreen.classList.remove('hidden');
            speedModeScreen.classList.add('hidden');
            startQuiz();
        }

        function showSpeedMode() {
            modeSelectionScreen.classList.add('hidden');
            quizModeScreen.classList.add('hidden');
            speedModeScreen.classList.remove('hidden');
            startSpeedRound();
        }

        // Quiz Mode Functions
        function createWFrageButtons() {
            choicesContainerEl.innerHTML = ''; 
            wFragenDetails.forEach(wFrage => {
                const button = document.createElement('button');
                button.classList.add('btn', 'w-frage-option-btn', ...wFrage.color.split(' '));
                button.dataset.wFrage = wFrage.word;
                
                const wordSpan = document.createElement('span');
                wordSpan.textContent = wFrage.word;
                
                const translationSpan = document.createElement('span');
                translationSpan.classList.add('translation');
                translationSpan.textContent = `(${wFrage.en} / ${wFrage.es})`;
                
                button.appendChild(wordSpan);
                button.appendChild(translationSpan);
                
                button.addEventListener('click', () => handleAnswer(wFrage.word));
                choicesContainerEl.appendChild(button);
            });
        }
        
        function startQuiz() {
            shuffledQuestions = [...quizQuestions];
            shuffleArray(shuffledQuestions);
            currentQuestionIndex = 0;
            score = 0;
            answerSelected = false;
            feedbackAreaEl.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            restartQuizBtn.classList.add('hidden');
            document.getElementById('question-area').classList.remove('hidden');
            choicesContainerEl.classList.remove('hidden');
            createWFrageButtons();
            loadQuestion();
        }

        function loadQuestion() {
            answerSelected = false;
            if (currentQuestionIndex < shuffledQuestions.length) {
                const question = shuffledQuestions[currentQuestionIndex];
                sentenceDisplayEl.innerHTML = question.sentence_german;
                translationEnEl.innerHTML = question.translation_en;
                translationEsEl.innerHTML = question.translation_es;
                
                feedbackAreaEl.classList.add('hidden');
                feedbackAreaEl.textContent = '';
                feedbackAreaEl.className = 'feedback-area hidden';

                nextQuestionBtn.classList.add('hidden');
                enableChoiceButtons();
                updateProgress();
            } else {
                showResults();
            }
        }

        function enableChoiceButtons(enable = true) {
            const buttons = choicesContainerEl.querySelectorAll('.w-frage-option-btn');
            buttons.forEach(button => {
                button.disabled = !enable;
                if (enable) {
                    wFragenDetails.forEach(detail => {
                        if (button.dataset.wFrage === detail.word) {
                            button.className = 'btn w-frage-option-btn';
                            detail.color.split(' ').forEach(cls => button.classList.add(cls));
                        }
                    });
                }
            });
        }

        function handleAnswer(selectedWFrage) {
            if (answerSelected) return;
            answerSelected = true;
            enableChoiceButtons(false);

            const question = shuffledQuestions[currentQuestionIndex];
            const isCorrect = selectedWFrage === question.correct_w_frage;

            feedbackAreaEl.classList.remove('hidden', 'correct', 'incorrect');
            if (isCorrect) {
                score++;
                feedbackAreaEl.innerHTML = `Richtig! Correct! ¬°Correcto! <br><span class="correct-answer-text">${question.correct_w_frage}</span>`;
                feedbackAreaEl.classList.add('correct');
                triggerConfetti();
            } else {
                feedbackAreaEl.innerHTML = `Falsch. Incorrecto. <br>The correct answer was: <span class="correct-answer-text">${question.correct_w_frage}</span>`;
                feedbackAreaEl.classList.add('incorrect');
            }
            
            const allButtons = choicesContainerEl.querySelectorAll('.w-frage-option-btn');
            allButtons.forEach(btn => {
                const originalColorClasses = wFragenDetails.find(d => d.word === btn.dataset.wFrage)?.color.split(' ') || [];
                btn.classList.remove(...originalColorClasses);

                if (btn.dataset.wFrage === selectedWFrage) {
                    if(isCorrect) {
                         btn.classList.add('bg-green-600', 'border-green-700', 'opacity-100'); 
                    } else {
                         btn.classList.add('bg-red-600', 'border-red-700', 'opacity-100'); 
                    }
                } else if (btn.dataset.wFrage === question.correct_w_frage && !isCorrect) { 
                     btn.classList.add('bg-green-400', 'border-green-500', 'opacity-100');
                } else {
                    btn.classList.add(...originalColorClasses);
                    btn.classList.add('opacity-50'); 
                }
            });

            if (currentQuestionIndex < shuffledQuestions.length -1) {
                 nextQuestionBtn.classList.remove('hidden');
            } else {
                 restartQuizBtn.textContent = "Show Results";
                 restartQuizBtn.classList.remove('hidden');
                 restartQuizBtn.onclick = showResults; 
            }
            updateProgress(); 
        }

        function updateProgress() {
            progressIndicatorEl.textContent = `Question: ${Math.min(currentQuestionIndex + 1, shuffledQuestions.length)} / ${shuffledQuestions.length}`;
            scoreIndicatorEl.textContent = `Score: ${score} / ${shuffledQuestions.length}`;
        }

        function showResults() {
            document.getElementById('question-area').classList.add('hidden');
            choicesContainerEl.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            
            feedbackAreaEl.classList.remove('hidden', 'incorrect');
            feedbackAreaEl.classList.add('correct'); 
            feedbackAreaEl.innerHTML = `Quiz Complete! Your final score: <br><span class="text-2xl font-bold">${score} out of ${shuffledQuestions.length}</span>`;
            
            progressIndicatorEl.textContent = `Quiz Finished!`;
            scoreIndicatorEl.textContent = `Final Score: ${score} / ${shuffledQuestions.length}`;

            restartQuizBtn.textContent = "Restart Quiz";
            restartQuizBtn.classList.remove('hidden');
            restartQuizBtn.onclick = startQuiz; 
        }

        // Speed Mode Functions
        function generateSpeedQuestions() {
            speedQuestions = [];
            // Generate 50 random questions from all 6 W-Fragen
            const wFragenList = ["WER", "WIE", "WO", "WOHER", "WAS", "WELCHE/R/S"];
            
            for (let i = 0; i < 50; i++) {
                const randomWFrageWord = wFragenList[Math.floor(Math.random() * wFragenList.length)];
                const wFrageInfo = wFragenDetails.find(w => w.word === randomWFrageWord);
                
                speedQuestions.push({
                    en: wFrageInfo.en,
                    es: wFrageInfo.es,
                    correct: wFrageInfo.word
                });
            }
        }

        function startSpeedRound() {
            generateSpeedQuestions();
            speedCurrentIndex = 0;
            speedScore = 0;
            speedPaused = false;
            speedAnswered = false;
            speedCompleteEl.classList.add('hidden');
            document.getElementById('speed-round-container').classList.remove('hidden');
            showSpeedQuestion();
            startSpeedTimer();
        }

        function showSpeedQuestion() {
            if (speedCurrentIndex >= speedQuestions.length) {
                completeSpeedRound();
                return;
            }

            speedAnswered = false;
            const currentQuestion = speedQuestions[speedCurrentIndex];
            speedWordEnEl.textContent = currentQuestion.en;
            speedWordEsEl.textContent = currentQuestion.es;
            speedProgressEl.textContent = `${speedCurrentIndex + 1} / 50`;
            
            // Hide feedback
            speedFeedbackEl.classList.add('hidden');
            
            // Create answer choices - always show all 6 W-Fragen in random order
            const allChoices = ["WER", "WIE", "WO", "WOHER", "WAS", "WELCHE/R/S"];
            shuffleArray(allChoices);
            
            // Create choice buttons
            speedChoicesEl.innerHTML = '';
            speedChoicesEl.className = 'grid grid-cols-2 gap-3 mt-6 mb-4';
            
            allChoices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'btn btn-primary text-base py-3 px-4 min-h-[60px]';
                button.textContent = choice;
                button.onclick = () => handleSpeedAnswer(choice);
                speedChoicesEl.appendChild(button);
            });
            
            // Change background color for variety
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
            ];
            
            document.getElementById('speed-round-container').style.background = colors[speedCurrentIndex % colors.length];
        }

        function handleSpeedAnswer(selectedAnswer) {
            if (speedAnswered) return;
            speedAnswered = true;
            
            const currentQuestion = speedQuestions[speedCurrentIndex];
            const isCorrect = selectedAnswer === currentQuestion.correct;
            
            if (isCorrect) {
                speedScore++;
                speedFeedbackEl.textContent = '‚úÖ Correct!';
                speedFeedbackEl.className = 'text-lg font-bold mb-4 text-green-300';
            } else {
                speedFeedbackEl.textContent = `‚ùå Wrong! Correct: ${currentQuestion.correct}`;
                speedFeedbackEl.className = 'text-lg font-bold mb-4 text-red-300';
            }
            
            speedFeedbackEl.classList.remove('hidden');
            
            // Disable all buttons
            const buttons = speedChoicesEl.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === selectedAnswer) {
                    btn.className = isCorrect ? 'btn bg-green-600 text-base py-3 px-4 min-h-[60px]' : 'btn bg-red-600 text-base py-3 px-4 min-h-[60px]';
                } else if (btn.textContent === currentQuestion.correct && !isCorrect) {
                    btn.className = 'btn bg-green-400 text-base py-3 px-4 min-h-[60px]';
                } else {
                    btn.className = 'btn bg-gray-500 text-base py-3 px-4 min-h-[60px] opacity-50';
                }
            });
            
            clearInterval(speedInterval);
            
            // Auto-advance after 1.5 seconds
            setTimeout(() => {
                speedCurrentIndex++;
                showSpeedQuestion();
                if (speedCurrentIndex < speedQuestions.length) {
                    startSpeedTimer();
                }
            }, 1500);
        }

        function startSpeedTimer() {
            if (speedPaused || speedAnswered) return;
            
            let timeLeft = speedTimePerCard;
            timerFillEl.style.width = '100%';
            
            speedInterval = setInterval(() => {
                if (speedPaused || speedAnswered) return;
                
                timeLeft -= 100;
                const percentage = (timeLeft / speedTimePerCard) * 100;
                timerFillEl.style.width = percentage + '%';
                
                if (timeLeft <= 0) {
                    clearInterval(speedInterval);
                    // Time's up - show as wrong answer
                    speedAnswered = true;
                    const currentQuestion = speedQuestions[speedCurrentIndex];
                    speedFeedbackEl.textContent = `‚è∞ Time's up! Correct: ${currentQuestion.correct}`;
                    speedFeedbackEl.className = 'text-lg font-bold mb-4 text-orange-300';
                    speedFeedbackEl.classList.remove('hidden');
                    
                    // Disable all buttons and show correct answer
                    const buttons = speedChoicesEl.querySelectorAll('button');
                    buttons.forEach(btn => {
                        btn.disabled = true;
                        if (btn.textContent === currentQuestion.correct) {
                            btn.className = 'btn bg-green-400 text-base py-3 px-4 min-h-[60px]';
                        } else {
                            btn.className = 'btn bg-gray-500 text-base py-3 px-4 min-h-[60px] opacity-50';
                        }
                    });
                    
                    setTimeout(() => {
                        speedCurrentIndex++;
                        showSpeedQuestion();
                        if (speedCurrentIndex < speedQuestions.length) {
                            startSpeedTimer();
                        }
                    }, 1500);
                }
            }, 100);
        }

        function toggleSpeedPause() {
            speedPaused = !speedPaused;
            speedPauseBtn.textContent = speedPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
            
            if (!speedPaused && speedCurrentIndex < speedQuestions.length && !speedAnswered) {
                startSpeedTimer();
            } else if (speedPaused) {
                clearInterval(speedInterval);
            }
        }

        function completeSpeedRound() {
            clearInterval(speedInterval);
            document.getElementById('speed-round-container').classList.add('hidden');
            speedCompleteEl.classList.remove('hidden');
            speedFinalScoreEl.textContent = speedScore;
            triggerConfetti();
        }

        // Event Listeners
        quizModeBtn.addEventListener('click', showQuizMode);
        speedModeBtn.addEventListener('click', showSpeedMode);
        
        nextQuestionBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            loadQuestion();
        });

        restartQuizBtn.addEventListener('click', startQuiz);
        backToMenuBtn.addEventListener('click', showModeSelection);
        
        speedPauseBtn.addEventListener('click', toggleSpeedPause);
        speedRestartBtn.addEventListener('click', startSpeedRound);
        speedBackToMenuBtn.addEventListener('click', showModeSelection);

        // Initial Load
        showModeSelection();
    </script>
</body>
</html>
