<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Deutsche Artikel Quiz (Der, Die, Das)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(to right top, #d928a9, #f65ce0, #fa8bf5, #fdb5fa, #fed6fe);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
            color: #374151;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .card {
            background-color: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            text-align: center;
            width: 100%;
            max-width: 700px;
        }
        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, border-color 0.3s ease, opacity 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            margin-top: 8px;
        }
        .btn:disabled {
            background-color: #d1d5db !important;
            color: #6b7280 !important;
            border-color: #d1d5db !important;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.7;
        }
        .btn:active:not(:disabled) { transform: translateY(1px); }
        .btn-primary { background-color: #6d28d9; }
        .btn-primary:hover:not(:disabled) { background-color: #5b21b6; }
        .btn-secondary { background-color: #4f46e5; }
        .btn-secondary:hover:not(:disabled) { background-color: #4338ca; }
        .btn-success { background-color: #059669; }
        .btn-success:hover:not(:disabled) { background-color: #047857; }

        .artikel-option-btn {
            padding: 18px 12px;
            font-size: 1.2rem;
            line-height: 1.3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
            flex-basis: calc(33.333% - 12px);
            min-width: 120px;
            word-break: break-word;
        }
        .btn-der { background-color: #2563eb; } .btn-der:hover:not(:disabled) { background-color: #1d4ed8; }
        .btn-die { background-color: #dc2626; } .btn-die:hover:not(:disabled) { background-color: #b91c1c; }
        .btn-das { background-color: #16a34a; } .btn-das:hover:not(:disabled) { background-color: #15803d; }

        .speed-round-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .speed-round-word {
            font-size: 4rem;
            font-weight: 800;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .speed-round-meaning {
            font-size: 1.5rem;
            margin: 10px 0;
            opacity: 0.9;
        }
        .timer-bar {
            width: 100%;
            height: 8px;
            background-color: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        .timer-fill {
            height: 100%;
            background-color: #10b981;
            transition: width 0.1s linear;
            border-radius: 4px;
        }
        .feedback-area {
            font-size: 0.95rem;
            font-weight: 500;
            padding: 12px;
            border-radius: 8px;
            min-height: 60px;
            margin-bottom: 1rem;
            text-align: center;
        }
        .feedback-area.correct {
            color: #065f46; background-color: #dcfce7; border: 1px solid #bbf7d0; display: block !important;
        }
        .feedback-area.incorrect {
            color: #b91c1c; background-color: #fee2e2; border: 1px solid #fecaca; display: block !important;
        }
        .feedback-area .correct-answer-text, .feedback-area strong {
            font-weight: 700;
        }
        .detailed-results-list {
            margin-top: 1rem;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #f9fafb;
        }
        .detailed-results-list h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        .detailed-results-list ul { list-style: none; padding: 0; }
        .detailed-results-list li {
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        .result-correct { background-color: #ecfdf5; border-left: 4px solid #10b981; }
        .result-incorrect { background-color: #fff1f2; border-left: 4px solid #f43f5e; }
        .progress-text { margin-top: 12px; font-size: 0.875rem; color: #6b7280; }
        .hidden { display: none !important; }

        #noun-display {
            font-size: 2.5rem; font-weight: 700; color: #4a044e; margin-bottom: 0.5rem;
        }
        #translation-display {
            font-size: 1rem; color: #6b7280; font-style: italic; margin-bottom: 2rem; min-height: 40px;
        }
        #artikel-choices-container {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 16px;
        }
        .mode-selection {
            display: flex; gap: 16px; justify-content: center; margin-bottom: 24px; flex-wrap: wrap;
        }
        .mode-btn {
            padding: 16px 24px; font-size: 1.1rem; border-radius: 12px; min-width: 200px;
        }
        kbd {
            font-family: monospace; background-color: #e2e8f0; color: #4a5568; padding: 3px 6px;
            border-radius: 4px; border: 1px solid #cbd5e0; font-size: 0.85em; box-shadow: 1px 1px 1px rgba(0,0,0,0.1);
        }
        @media (max-width: 768px) {
            #artikel-choices-container .btn {
                flex-basis: calc(33.333% - 10px); font-size: 1.1rem;
            }
            .mode-selection { flex-direction: column; align-items: center; }
            .speed-round-word { font-size: 3rem; }
            #noun-display { font-size: 2rem; }
            .detailed-results-list { max-height: 180px; }
        }
        @media (max-width: 640px) {
            .card { padding: 20px; }
            .btn { padding: 10px 16px; font-size: 0.9rem; }
            .artikel-option-btn { font-size: 1rem; min-height: 70px; }
            #noun-display { font-size: 1.8rem; }
            .feedback-area { font-size: 0.9rem; min-height: 50px; }
            #artikel-choices-container .btn {
                flex-basis: calc(100% - 8px); min-width: 100px;
            }
            .speed-round-word { font-size: 2.5rem; }
            .speed-round-meaning { font-size: 1.2rem; }
            .detailed-results-list { max-height: 150px; font-size: 0.8rem;}
            .detailed-results-list li { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div id="main-container" class="card">
        <div id="mode-selection-screen" class="">
            <h1 class="text-2xl sm:text-3xl font-bold text-purple-700 mb-6 text-center">Deutsche Nomen Artikel</h1>
            <div class="mode-selection">
                <button id="quiz-mode-btn" class="btn btn-primary mode-btn">
                    üìù Der/Die/Das Quiz
                    <div class="text-sm opacity-90 mt-1">Teste dein Wissen</div>
                </button>
                <button id="speed-mode-btn" class="btn btn-success mode-btn">
                    ‚ö° Speed Learning
                    <div class="text-sm opacity-90 mt-1">Schnelle Karteikarten</div>
                </button>
            </div>
        </div>

        <div id="quiz-mode-screen" class="hidden">
            <h1 class="text-2xl sm:text-3xl font-bold text-purple-700 mb-6 text-center">Der, Die, oder Das?</h1>
            <div id="question-area" class="mb-6">
                 <p id="noun-display" class="text-center" style="min-height: 60px;"></p>
                 <p id="translation-display" class="text-center"></p>
            </div>
            <div id="artikel-choices-container" class="mb-6">
                <button id="der-btn" class="btn artikel-option-btn btn-der" data-artikel="der">DER</button>
                <button id="die-btn" class="btn artikel-option-btn btn-die" data-artikel="die">DIE</button>
                <button id="das-btn" class="btn artikel-option-btn btn-das" data-artikel="das">DAS</button>
            </div>
            <div id="feedback-area" class="feedback-area hidden"></div>
            <div id="detailed-results-list" class="detailed-results-list hidden"></div>
            <div id="quiz-controls-area" class="text-center mt-4">
                <button id="next-question-btn" class="btn btn-primary hidden">N√§chste Frage</button>
                <button id="restart-quiz-btn" class="btn btn-secondary hidden">Quiz neu starten</button>
                <button id="back-to-menu-btn" class="btn btn-secondary">Zur√ºck zum Men√º</button>
            </div>
            <div id="progress-indicator" class="progress-text mt-4 text-center">Frage 0 / 0</div>
            <div id="score-indicator" class="progress-text mt-1 text-center">Punkte: 0 / 0</div>
            <div id="hint-area" class="progress-text mt-3 text-center hidden"></div>
        </div>

         <div id="speed-mode-screen" class="hidden">
            <div id="speed-round-container" class="speed-round-card">
                <div id="speed-question-text" class="text-xl mb-4 opacity-90">Welcher Artikel?</div>
                <div id="speed-word-de" class="speed-round-word text-yellow-200">Haus</div>
                <div id="speed-word-trans" class="speed-round-meaning text-yellow-100">House / Casa</div>
                <div class="timer-bar">
                    <div id="timer-fill" class="timer-fill" style="width: 100%;"></div>
                </div>
                <div id="speed-choices" class="grid grid-cols-3 gap-4 mt-6 mb-4"></div>
                <div id="speed-feedback" class="text-lg font-bold mb-4 hidden"></div>
                <div id="speed-progress" class="text-lg opacity-90">1 / 100</div>
                <div id="speed-controls" class="mt-6">
                     <button id="speed-pause-btn" class="btn btn-secondary mr-4">‚è∏Ô∏è Pause</button>
                     <button id="speed-back-to-menu-btn-ingame" class="btn btn-secondary">Zur√ºck</button>
                </div>
            </div>
            <div id="speed-complete" class="hidden text-center">
                <h2 class="text-2xl font-bold text-green-600 mb-4">üéâ Speed Runde geschafft!</h2>
                <p class="text-lg mb-2">Du hast <span id="speed-total-qs">100</span> Fragen beantwortet!</p>
                <p class="text-xl font-bold text-purple-600 mb-6">Endstand: <span id="speed-final-score">0</span> / <span id="speed-final-total">100</span></p>
                <button id="speed-restart-btn" class="btn btn-success mr-4">üîÑ Neu starten</button>
                <button id="speed-back-to-menu-btn" class="btn btn-secondary">Zur√ºck zum Men√º</button>
            </div>
        </div>
    </div>

    <script>
       // Global variables
       let foodNouns = [];
       let derDieDasUserAnswers = [];

        // Quiz Mode (DerDieDas) Variables
        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];
        let answerSelected = false;
        let autoAdvanceTimeout;

        // Speed Mode Variables
        let speedCurrentIndex = 0;
        let speedInterval;
        let speedPaused = false;
        let speedTimePerCard = 5000;
        let speedQuestions = [];
        let speedScore = 0;
        let speedAnswered = false;

        // Elements
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const quizModeScreen = document.getElementById('quiz-mode-screen');
        const speedModeScreen = document.getElementById('speed-mode-screen');

        const quizModeBtn = document.getElementById('quiz-mode-btn');
        const speedModeBtn = document.getElementById('speed-mode-btn');

        // Quiz (DerDieDas) elements
        const nounDisplayEl = document.getElementById('noun-display');
        const translationDisplayEl = document.getElementById('translation-display');
        const choicesContainerEl = document.getElementById('artikel-choices-container');
        const feedbackAreaEl = document.getElementById('feedback-area');
        const detailedResultsListEl = document.getElementById('detailed-results-list');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const progressIndicatorEl = document.getElementById('progress-indicator');
        const scoreIndicatorEl = document.getElementById('score-indicator');
        const hintAreaEl = document.getElementById('hint-area');
        const artikelButtons = choicesContainerEl.querySelectorAll('.artikel-option-btn');

        // Speed elements
        const speedWordDeEl = document.getElementById('speed-word-de');
        const speedWordTransEl = document.getElementById('speed-word-trans');
        const speedChoicesEl = document.getElementById('speed-choices');
        const speedFeedbackEl = document.getElementById('speed-feedback');
        const timerFillEl = document.getElementById('timer-fill');
        const speedProgressEl = document.getElementById('speed-progress');
        const speedPauseBtn = document.getElementById('speed-pause-btn');
        const speedCompleteEl = document.getElementById('speed-complete');
        const speedRestartBtn = document.getElementById('speed-restart-btn');
        const speedBackToMenuBtn = document.getElementById('speed-back-to-menu-btn');
        const speedBackToMenuBtnIngame = document.getElementById('speed-back-to-menu-btn-ingame');
        const speedFinalScoreEl = document.getElementById('speed-final-score');
        const speedTotalQsEl = document.getElementById('speed-total-qs');
        const speedFinalTotalEl = document.getElementById('speed-final-total');
        const speedRoundContainer = document.getElementById('speed-round-container');

        async function loadQuizData() {
            try {
                const foodNounsResponse = await fetch('nouns.json');
                if (!foodNounsResponse.ok) throw new Error(`HTTP error! status: ${foodNounsResponse.status} for nouns.json`);
                foodNouns = await foodNounsResponse.json();
                initializeUI();
            } catch (error) {
                console.error("Could not load quiz data:", error);
                const mainContainer = document.getElementById('main-container');
                mainContainer.innerHTML = `<div class="text-center"><h1 class="text-2xl font-bold text-red-600 mb-4">Fehler beim Laden</h1><p class="mb-2">Quizdaten (JSON) nicht gefunden oder fehlerhaft.</p><p class="text-sm text-gray-700 mb-4">Details: ${error.message}</p><button onclick="location.reload()" class="btn btn-primary">Neu laden</button></div>`;
            }
        }

        function initializeUI() {
            quizModeBtn.disabled = false;
            speedModeBtn.disabled = false;
            showModeSelection();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function triggerConfetti() {
            if (typeof confetti === 'function') confetti({ particleCount: 80, spread: 60, origin: { y: 0.6 } });
        }

        function clearAutoAdvance(timeoutVar) { clearTimeout(timeoutVar); }

        function showModeSelection() {
            modeSelectionScreen.classList.remove('hidden');
            quizModeScreen.classList.add('hidden');
            speedModeScreen.classList.add('hidden');
            clearInterval(speedInterval);
            clearAutoAdvance(autoAdvanceTimeout);
            hintAreaEl.classList.add('hidden');
            detailedResultsListEl.classList.add('hidden');
        }

        function showQuizMode() {
            if (foodNouns.length === 0) { alert("Keine Fragen f√ºr Der/Die/Das Quiz geladen."); return; }
            modeSelectionScreen.classList.add('hidden');
            quizModeScreen.classList.remove('hidden');
            startQuiz();
        }

        function showSpeedMode() {
            if (foodNouns.length === 0) { alert("Keine Fragen f√ºr Speed Learning geladen."); return; }
            modeSelectionScreen.classList.add('hidden');
            speedModeScreen.classList.remove('hidden');
            startSpeedRound();
        }

        // --- DerDieDas Quiz Functions ---
        function startQuiz() {
            shuffledQuestions = [...foodNouns];
            shuffleArray(shuffledQuestions);
            currentQuestionIndex = 0;
            score = 0;
            answerSelected = false;
            derDieDasUserAnswers = [];
            detailedResultsListEl.classList.add('hidden');
            clearAutoAdvance(autoAdvanceTimeout);
            feedbackAreaEl.classList.add('hidden');
            feedbackAreaEl.className = 'feedback-area hidden';
            nextQuestionBtn.classList.add('hidden');
            restartQuizBtn.classList.add('hidden');
            hintAreaEl.classList.add('hidden');
            document.getElementById('question-area').classList.remove('hidden');
            choicesContainerEl.classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            answerSelected = false;
            clearAutoAdvance(autoAdvanceTimeout);
            if (currentQuestionIndex < shuffledQuestions.length) {
                const question = shuffledQuestions[currentQuestionIndex];
                nounDisplayEl.textContent = question.noun;
                translationDisplayEl.textContent = `${question.en} / ${question.es}`;
                feedbackAreaEl.classList.add('hidden','correct','incorrect');
                feedbackAreaEl.textContent = '';
                nextQuestionBtn.classList.add('hidden');
                hintAreaEl.classList.add('hidden');
                enableChoiceButtons();
                updateProgress();
            } else {
                showResults();
            }
        }

        function enableChoiceButtons(enable = true) {
            artikelButtons.forEach(button => {
                button.disabled = !enable;
                button.classList.remove('opacity-50', 'bg-green-600', 'bg-red-600', 'bg-green-400');
                const baseClass = `btn-${button.dataset.artikel}`;
                button.classList.add(baseClass);
            });
        }

        function handleAnswer(selectedArtikel) {
            if (answerSelected) return;
            answerSelected = true;

            const question = shuffledQuestions[currentQuestionIndex];
            const isCorrect = selectedArtikel === question.article;

            derDieDasUserAnswers.push({
                question: JSON.parse(JSON.stringify(question)),
                userAnswer: selectedArtikel,
                isCorrect: isCorrect
            });

            feedbackAreaEl.classList.remove('hidden');
            if (isCorrect) {
                score++;
                feedbackAreaEl.innerHTML = `Richtig! <span class="correct-answer-text">${question.article} ${question.noun}</span>`;
                feedbackAreaEl.className = 'feedback-area correct';
                triggerConfetti();
            } else {
                feedbackAreaEl.innerHTML = `Falsch. Richtig ist: <span class="correct-answer-text">${question.article} ${question.noun}</span>`;
                feedbackAreaEl.className = 'feedback-area incorrect';
            }

            artikelButtons.forEach(btn => {
                const isSelectedButton = btn.dataset.artikel === selectedArtikel;
                const isCorrectButton = btn.dataset.artikel === question.article;
                btn.classList.remove('btn-der', 'btn-die', 'btn-das', 'opacity-50');
                if (isSelectedButton) btn.classList.add(isCorrect ? 'bg-green-600' : 'bg-red-600');
                else if (isCorrectButton) btn.classList.add('bg-green-400');
                else {
                    btn.classList.add('opacity-50');
                    const baseClass = `btn-${btn.dataset.artikel}`;
                    btn.classList.add(baseClass);
                }
                btn.disabled = true;
            });
            updateProgress();
            if (currentQuestionIndex < shuffledQuestions.length - 1) {
                 autoAdvanceTimeout = setTimeout(() => { currentQuestionIndex++; loadQuestion(); }, 2000);
            } else {
                  autoAdvanceTimeout = setTimeout(() => {
                    feedbackAreaEl.classList.add('hidden');
                    showResults();
                  }, 2000);
            }
        }

        function updateProgress() {
            progressIndicatorEl.textContent = `Frage: ${Math.min(currentQuestionIndex + 1, shuffledQuestions.length)} / ${shuffledQuestions.length}`;
            scoreIndicatorEl.textContent = `Punkte: ${score} / ${shuffledQuestions.length}`;
        }

        function showResults() {
            clearAutoAdvance(autoAdvanceTimeout);
            document.getElementById('question-area').classList.add('hidden');
            choicesContainerEl.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');

            feedbackAreaEl.classList.remove('hidden');
            feedbackAreaEl.className = 'feedback-area correct';
            feedbackAreaEl.innerHTML = `Quiz beendet! Endergebnis: <strong class="text-2xl">${score}</strong> / ${shuffledQuestions.length}`;

            detailedResultsListEl.innerHTML = '';
            let resultsHTML = '<h3 class="text-purple-700">Deine Antworten im Detail:</h3><ul>';
            derDieDasUserAnswers.forEach(ans => {
                resultsHTML += `<li class="mb-2 p-2 rounded-md ${ans.isCorrect ? 'result-correct' : 'result-incorrect'}">`;
                resultsHTML += `<strong>${ans.question.noun}</strong> (${ans.question.en} / ${ans.question.es}): `;
                if (ans.isCorrect) {
                    resultsHTML += `<span class="text-green-700 font-semibold">Richtig als "${ans.userAnswer.toUpperCase()}"</span>`;
                } else {
                    resultsHTML += `<span class="text-red-700">Du: "${ans.userAnswer.toUpperCase()}". Richtig:</span> <strong class="text-blue-600">"${ans.question.article.toUpperCase()}"</strong>.`;
                }
                resultsHTML += `</li>`;
            });
            resultsHTML += '</ul>';
            detailedResultsListEl.innerHTML = resultsHTML;
            detailedResultsListEl.classList.remove('hidden');

            progressIndicatorEl.textContent = `Quiz beendet!`;
            scoreIndicatorEl.textContent = `Endstand: ${score} / ${shuffledQuestions.length}`;
            restartQuizBtn.textContent = "Quiz neu starten";
            restartQuizBtn.classList.remove('hidden');
            restartQuizBtn.onclick = startQuiz;
            hintAreaEl.innerHTML = `Dr√ºcke <kbd>Leertaste</kbd> zum Neustarten`;
            hintAreaEl.classList.remove('hidden');
        }

        // --- Speed Mode Functions ---
        function startSpeedRound() {
            speedQuestions = [...foodNouns]; shuffleArray(speedQuestions); speedCurrentIndex = 0; speedScore = 0;
            speedPaused = false; speedAnswered = false; speedCompleteEl.classList.add('hidden');
            speedRoundContainer.classList.remove('hidden'); speedPauseBtn.textContent = '‚è∏Ô∏è Pause';
            speedTotalQsEl.textContent = speedQuestions.length; speedFinalTotalEl.textContent = speedQuestions.length;
            showSpeedQuestion();
        }
        function showSpeedQuestion() {
            if (speedCurrentIndex >= speedQuestions.length) { completeSpeedRound(); return; }
            speedAnswered = false; const q = speedQuestions[speedCurrentIndex];
            speedWordDeEl.textContent = q.noun; speedWordTransEl.textContent = `${q.en} / ${q.es}`;
            speedProgressEl.textContent = `${speedCurrentIndex + 1} / ${speedQuestions.length}`;
            speedFeedbackEl.classList.add('hidden'); speedChoicesEl.innerHTML = '';
            const articles = ["der", "die", "das"]; const colors = { der: "btn-der", die: "btn-die", das: "btn-das" };
            articles.forEach(art => {
                const btn = document.createElement('button');
                btn.className = `btn ${colors[art]} text-lg py-4 px-5`; btn.textContent = art.toUpperCase();
                btn.onclick = () => handleSpeedAnswer(art); speedChoicesEl.appendChild(btn);
            });
            const bgColors = ['linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'];
            speedRoundContainer.style.background = bgColors[speedCurrentIndex % bgColors.length];
            startSpeedTimer();
        }
        function handleSpeedAnswer(selectedAnswer) {
            if (speedAnswered) return; speedAnswered = true; clearInterval(speedInterval);
            const q = speedQuestions[speedCurrentIndex]; const isCorrect = selectedAnswer === q.article;
            if (isCorrect) { speedScore++; speedFeedbackEl.textContent = '‚úÖ Richtig!'; speedFeedbackEl.className = 'text-lg font-bold mb-4 text-green-300';
            } else { speedFeedbackEl.textContent = `‚ùå Falsch! Richtig: ${q.article.toUpperCase()}`; speedFeedbackEl.className = 'text-lg font-bold mb-4 text-red-300'; }
            speedFeedbackEl.classList.remove('hidden');
            const buttons = speedChoicesEl.querySelectorAll('button');
            buttons.forEach(btn => { btn.disabled = true; const btnArt = btn.textContent.toLowerCase();
                if (btnArt === selectedAnswer) btn.className = isCorrect ? 'btn bg-green-600 text-lg py-4 px-5' : 'btn bg-red-600 text-lg py-4 px-5';
                else if (btnArt === q.article && !isCorrect) btn.className = 'btn bg-green-400 text-lg py-4 px-5';
                else btn.className = 'btn bg-gray-500 text-lg py-4 px-5 opacity-50';
            });
            setTimeout(() => { speedCurrentIndex++; showSpeedQuestion(); }, 1500);
        }
        function startSpeedTimer() {
            if (speedPaused || speedAnswered) return; clearInterval(speedInterval);
            timerFillEl.style.transition = 'none'; timerFillEl.style.width = '100%'; timerFillEl.offsetHeight;
            timerFillEl.style.transition = `width ${speedTimePerCard / 1000}s linear`; timerFillEl.style.width = '0%';
            speedInterval = setTimeout(() => {
                if (speedPaused || speedAnswered) return; speedAnswered = true; const q = speedQuestions[speedCurrentIndex];
                speedFeedbackEl.textContent = `‚è∞ Zeit um! Richtig: ${q.article.toUpperCase()}`; speedFeedbackEl.className = 'text-lg font-bold mb-4 text-orange-300';
                speedFeedbackEl.classList.remove('hidden'); speedChoicesEl.querySelectorAll('button').forEach(btn => { btn.disabled = true;
                    if (btn.textContent.toLowerCase() === q.article) btn.className = 'btn bg-green-400 text-lg py-4 px-5';
                    else btn.className = 'btn bg-gray-500 text-lg py-4 px-5 opacity-50';});
                setTimeout(() => { speedCurrentIndex++; showSpeedQuestion(); }, 1500);
            }, speedTimePerCard);
        }
        function toggleSpeedPause() {
            speedPaused = !speedPaused; speedPauseBtn.textContent = speedPaused ? '‚ñ∂Ô∏è Weiter' : '‚è∏Ô∏è Pause';
            if (speedPaused) { clearInterval(speedInterval); const compStyle = getComputedStyle(timerFillEl);
                timerFillEl.style.width = compStyle.width; timerFillEl.style.transition = 'none';
            } else { if (speedCurrentIndex < speedQuestions.length && !speedAnswered) {
                    const currWidthPx = parseFloat(timerFillEl.style.width||'0'); const parWidthPx = timerFillEl.parentNode.offsetWidth;
                    const currWidthPerc = (currWidthPx / parWidthPx) * 100; const remTime = (currWidthPerc / 100) * speedTimePerCard;
                    timerFillEl.style.transition = `width ${remTime / 1000}s linear`; timerFillEl.style.width = '0%';
                    clearInterval(speedInterval); speedInterval = setTimeout(() => { if (speedPaused || speedAnswered) return; speedAnswered = true;
                        const q = speedQuestions[speedCurrentIndex]; speedFeedbackEl.textContent = `‚è∞ Zeit um! Richtig: ${q.article.toUpperCase()}`;
                        speedFeedbackEl.className = 'text-lg font-bold mb-4 text-orange-300'; speedFeedbackEl.classList.remove('hidden');
                        setTimeout(() => { speedCurrentIndex++; showSpeedQuestion(); }, 1500);
                    }, remTime); } }
        }
        function completeSpeedRound() {
            clearInterval(speedInterval); speedRoundContainer.classList.add('hidden');
            speedCompleteEl.classList.remove('hidden'); speedFinalScoreEl.textContent = speedScore; triggerConfetti();
        }

        // --- Event Listeners & Initial Load ---
        function handleSpacebar(event) {
            if (event.code !== 'Space' && event.keyCode !== 32) return;
            if (document.activeElement && (document.activeElement.tagName === 'BUTTON' || document.activeElement.tagName === 'INPUT')) {
                const activeId = document.activeElement.id;
                const mainCtrlIds = ['next-question-btn', 'restart-quiz-btn'];
                if (!mainCtrlIds.includes(activeId)) return;
            }
            event.preventDefault();
            if (!quizModeScreen.classList.contains('hidden')) {
                if (!restartQuizBtn.classList.contains('hidden')) { clearAutoAdvance(autoAdvanceTimeout); restartQuizBtn.click(); }
                else if (!nextQuestionBtn.classList.contains('hidden')) { clearAutoAdvance(autoAdvanceTimeout); nextQuestionBtn.click(); }
            }
        }

        if(quizModeBtn) quizModeBtn.addEventListener('click', showQuizMode);
        if(speedModeBtn) speedModeBtn.addEventListener('click', showSpeedMode);
        if(backToMenuBtn) backToMenuBtn.addEventListener('click', showModeSelection);
        if(artikelButtons) artikelButtons.forEach(button => button.addEventListener('click', () => handleAnswer(button.dataset.artikel)));
        if(speedPauseBtn) speedPauseBtn.addEventListener('click', toggleSpeedPause);
        if(speedRestartBtn) speedRestartBtn.addEventListener('click', startSpeedRound);
        if(speedBackToMenuBtn) speedBackToMenuBtn.addEventListener('click', showModeSelection);
        if(speedBackToMenuBtnIngame) speedBackToMenuBtnIngame.addEventListener('click', showModeSelection);
        document.addEventListener('keydown', handleSpacebar);

        async function initialSetup() {
            if(quizModeBtn) quizModeBtn.disabled = true;
            if(speedModeBtn) speedModeBtn.disabled = true;

            const loadingMsg = document.createElement('p');
            loadingMsg.id = "loading-data-msg";
            loadingMsg.textContent = "Lade Quizdaten...";
            loadingMsg.className = "text-center text-purple-700 mb-4";
            const modeSelDiv = modeSelectionScreen.querySelector('.mode-selection');

            if (modeSelDiv) {
                modeSelectionScreen.insertBefore(loadingMsg, modeSelDiv);
            } else {
                modeSelectionScreen.appendChild(loadingMsg);
            }

            await loadQuizData();

            const existingMsg = document.getElementById('loading-data-msg');
            if(existingMsg) existingMsg.remove();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialSetup);
        } else {
            initialSetup();
        }

    </script>
</body>
</html>
